# CN Assignment 2: Custom DNS Resolver and PCAP-Based Evaluation

This repository implements an iterative DNS resolver and a Mininet-based testbed to evaluate DNS performance. The evaluation includes a baseline using a public resolver (Part B), deployment and verification of a custom iterative resolver (Part C), and a comparative analysis with visualizations (Part D).

The project is designed for reproducible execution on Linux with Mininet and Python 3.

## 1. Overview

The custom resolver listens on UDP port 53 within a Mininet host (10.0.0.5) and performs iterative resolution from root to authoritative servers. Scripts are provided to: (i) extract domains from supplied PCAPs, (ii) execute resolution experiments with both public and custom DNS resolvers, and (iii) generate structured outputs and plots suitable for reporting.

## 2. Project structure

- `custom_dns_server.py` — Iterative DNS resolver (UDP:53) with detailed per-query logging to `/tmp/dns_resolver.log` and `/tmp/dns_queries.json`.
- `setup_custom_dns.py` — Helper to start a basic Mininet topology, launch the resolver on the `dns` host, and configure hosts to use 10.0.0.5.
- `part_b_resolver.py` — Part B baseline: sets Mininet+NAT, resolves PCAP domains via a public DNS (default 8.8.8.8), and writes `part_b_results.json`.
- `part_c.py` — Part C: deploys the custom iterative resolver, isolates per-host `/etc/resolv.conf`, and verifies queries against 10.0.0.5.
- `part_d.py` — Part D: runs experiments against the custom resolver, compares with Part B, and produces CSV/JSON and plots.
- `generate_visualizations.py` — Generates figures from `/tmp/dns_queries.json` (latency, servers visited, step breakdown, summary table).
- `test_dns_from_pcap.py` — Utility to extract domains from a PCAP and query the custom resolver using `dig`.
- `topology.py` — Minimal topology example for quick connectivity checks.
- `requirements.txt` — Python dependencies for host environment.
- `data/` — Input PCAPs: `PCAP_1_H1.pcap`, `PCAP_2_H2.pcap`, `PCAP_3_H3.pcap`, `PCAP_4_H4.pcap`.
- `results/` — Aggregated experiment outputs (JSON/CSV) written by Parts B and D.
- `plots/` — Figures generated by `generate_visualizations.py`.
- `analysis/`, `resolver/` — Auxiliary analysis tooling and logs (not required for the main workflow).

## 3. System requirements

- Linux host with root access
- Mininet with Open vSwitch
- Python 3.8 or newer
- System utilities: `dnsutils` (for `dig`), `net-tools` or `iproute2`

## 4. Installation

Install prerequisites on Debian/Ubuntu:

```bash
sudo apt-get update
sudo apt-get install -y mininet python3-pip dnsutils net-tools iproute2
pip3 install -r requirements.txt
sudo apt-get install openvswitch-testcontroller
```

Notes:
- Parts C and D will install `dnspython` in the Mininet `dns` host if not present. Installing via `requirements.txt` is recommended for consistency.
- Internet access is required during runs; the NAT node provides egress.

## 5. Data

Ensure the following PCAPs are available under `data/`:

- `PCAP_1_H1.pcap`
- `PCAP_2_H2.pcap`
- `PCAP_3_H3.pcap`
- `PCAP_4_H4.pcap`

## 6. Usage

All commands should be run from the repository root. Use `sudo` to allow Mininet to set up networking and to permit DNS binding within the Mininet namespace.

### 6.1 Part B — Baseline using a public DNS resolver

```bash
sudo python3 part_b_resolver.py           # default: 8.8.8.8
sudo python3 part_b_resolver.py 1.1.1.1   # optional: specify DNS server
```

Behavior:
- Creates the Mininet+NAT topology and verifies connectivity.
- Configures hosts (H1–H4) to use the specified public DNS server.
- Extracts unique domains from the per-host PCAPs and resolves with `nslookup`.
- Writes a combined summary to `part_b_results.json` and prints a per-host summary.
- Opens the Mininet CLI for manual checks (type `exit` to quit).

Output:
- `part_b_results.json` (repository root)

### 6.2 Part C — Deploy and verify the custom iterative resolver

```bash
sudo python3 part_c.py
```

Behavior:
- Starts the custom DNS resolver on the `dns` host (10.0.0.5:53).
- Isolates each Mininet host’s `/etc/resolv.conf` via bind mounts (the VM’s DNS is not modified).
- Configures hosts to query 10.0.0.5 and performs simple resolution checks.

Key logs (inside the Mininet `dns` host):
- `/tmp/dns_server.log` — server stdout/stderr
- `/tmp/dns_resolver.log` — detailed per-step logs
- `/tmp/dns_queries.json` — structured per-query JSON

### 6.3 Part D — Experiments with the custom resolver, comparison, and plots

Prerequisite: Run Part B first to produce `part_b_results.json`.

```bash
sudo python3 part_d.py
```

Behavior:
- Sets up Mininet+NAT and isolated DNS configuration.
- Starts the custom resolver (10.0.0.5) and resolves domains extracted from the PCAPs using `dig`.
- Produces per-host and aggregate results under `results/`.
- Compares Part B (public DNS) and Part D (custom DNS) and writes JSON/CSV summaries.
- Generates plots for the first 10 queries from H1 using `generate_visualizations.py`.
- Opens the Mininet CLI for verification.

Outputs:
- Results:
	- `results/part_d_results.json` (aggregate)
	- `results/part_d_h1_results.json`, `results/part_d_h2_results.json`, `results/part_d_h3_results.json`, `results/part_d_h4_results.json`
	- `results/part_b_d_comparison.json`, `results/part_b_d_comparison.csv`
- Plots (default `plots/`):
	- `h1_latency_first_10_queries.png`
	- `h1_servers_visited_first_10_queries.png`
	- Additional figures: resolution step breakdown and summary table

## 7. Additional utilities

- Quick setup and test of the custom DNS:

```bash
sudo python3 setup_custom_dns.py
```

- Domain extraction and testing for a single PCAP:

```bash
# Inside Mininet (example for h1)
mininet> h1 python3 test_dns_from_pcap.py data/PCAP_1_H1.pcap

# From the VM host
python3 test_dns_from_pcap.py data/PCAP_1_H1.pcap
```

- Regenerate visualizations from a saved query log:

```bash
python3 generate_visualizations.py /tmp/dns_queries.json ./plots
```
